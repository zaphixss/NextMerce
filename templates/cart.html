{% extends 'partials/base.html' %}
{% load static %}

{% block content %}
<div
    class="bg-white border-b border-gray-200 py-8 flex items-center justify-between px-4 md:px-8 lg:px-12 2xl:px-[19rem]">
    <h1 class="font-medium text-3xl">Cart</h1>
    <div class="text-sm">
        <a href="{% url 'index' %}" class="hover:text-blue-400">Home /</a>
        <a href="{% url 'index' %}" class="text-[#2563eb]">Cart</a>
    </div>
</div>

<section class="bg-[#F3F4F6] py-14 px-4 md:px-8 lg:px-12 2xl:px-[19rem]">

    <div class="flex items-center justify-between">
        <h2 class="text-2xl font-semibold text-slate-900">Your Cart</h2>

        {% if cart %}
        <a href="#" class="text-sm font-medium text-blue-600 hover:text-blue-700">
            Clear Shopping Cart
        </a>
        {% endif %}
    </div>

    {% if cart %}

    <div class="mt-8 overflow-hidden rounded-2xl bg-white shadow-sm ring-1 ring-slate-200">

        <div
            class="hidden md:grid grid-cols-12 gap-4 border-b border-slate-200 px-6 py-5 text-sm font-semibold text-slate-900">
            <div class="col-span-5">Product</div>
            <div class="col-span-2">Price</div>
            <div class="col-span-3 text-center">Quantity</div>
            <div class="col-span-1 text-right">Subtotal</div>
            <div class="col-span-1 text-right">Action</div>
        </div>

        {% for c in cart %}
        <div
            class="relative flex flex-col gap-4 p-6 border-b border-slate-100 last:border-0 md:grid md:grid-cols-12 md:items-center md:gap-4 md:border-none">

            <div class="col-span-5 flex items-center gap-5 min-w-0">
                <div class="h-16 w-16 overflow-hidden rounded-2xl bg-slate-100 ring-1 ring-slate-200 shrink-0">
                    <img src="{{ c.product.image.url }}" alt="{{ c.product.name }}"
                        class="h-full w-full object-cover" />
                </div>

                <div class="min-w-0 pr-10 md:pr-0">
                    <p class="truncate text-[15px] font-semibold text-slate-900">{{ c.product.name }}</p>
                    <p class="block md:hidden text-sm font-medium text-slate-500 mt-1">${{ c.product.sale_price }}</p>
                </div>
            </div>

            <div class="hidden md:block col-span-2 text-slate-700 font-medium">
                ${{ c.product.sale_price }}
            </div>

            <div class="col-span-3 flex justify-start md:justify-center items-center w-full mt-2 md:mt-0">
                <form class="flex items-center" method="POST" action="{% url 'cart_update' c.id %}">
                    {% csrf_token %}
                    <label class="mr-3 text-sm font-medium text-slate-500 md:hidden">Qty:</label>
                    <input type="number" name="qty" value="{{c.qty}}"
                        class="w-20 md:w-24 rounded-full border border-slate-300 bg-white px-4 py-2 text-sm text-slate-900 shadow-sm outline-none focus:border-indigo-600 focus:ring-2 focus:ring-indigo-500/60 text-center">
                    <button class="ml-2 p-2 rounded-full text-indigo-600 hover:text-indigo-700"><i
                            class="fas fa-check-circle text-xl"></i></button>
                </form>
            </div>

            <div class="col-span-1 flex justify-between md:block mt-2 md:mt-0 items-center">
                <span class="text-sm font-medium text-slate-500 md:hidden">Subtotal:</span>
                <span class="text-right font-semibold text-slate-900" data-subtotal>${{ c.sub_total }}</span>
            </div>

            <div class="col-span-1 flex justify-end absolute top-4 right-4 md:static">
                <a href="{% url 'cart_delete' c.id %}"
                    class="grid h-9 w-9 md:h-11 md:w-11 place-items-center rounded-full border border-slate-200 text-slate-700 hover:bg-slate-100"
                    aria-label="Remove">
                    <i class="fa-regular fa-trash-can text-sm"></i>
                </a>
            </div>
        </div>

        {% if not forloop.last %}
        <div class="hidden md:block mx-6 h-px bg-slate-200"></div>
        {% endif %}

        {% endfor %}
    </div>


    <form action="{% url 'create_checkout_view' %}" method="POST" class="space-y-4">
        {% csrf_token %}
        <div class="mt-10 flex flex-col lg:flex-row items-start justify-between gap-8">

            <div class="bg-white p-6 rounded-lg shadow-md w-full lg:w-[58%]">
                <h3 class="text-lg font-bold text-gray-800">Customer Information</h3>
                <hr class="my-4 border-gray-200">

                <div class="space-y-4">
                    <div>
                        <label for="fullName" class="block text-sm font-medium text-gray-700">Full Name</label>
                        <input type="text" id="fullName" name="fullname" required
                            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    </div>

                    <div>
                        <label for="mobile" class="block text-sm font-medium text-gray-700">Mobile</label>
                        <input type="tel" id="mobile" name="mobile" required
                            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    </div>

                    <div>
                        <label for="address" class="block text-sm font-medium text-gray-700">Address</label>
                        <input type="text" id="address" name="address" required
                            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    </div>

                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <label for="city" class="block text-sm font-medium text-gray-700">City</label>
                            <input type="text" id="city" name="city" required
                                class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        </div>
                        <div>
                            <label for="state" class="block text-sm font-medium text-gray-700">State</label>
                            <input type="text" id="state" name="state" required
                                class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        </div>
                    </div>

                    <div>
                        <label for="country" class="block text-sm font-medium text-gray-700">Country</label>
                        <input type="text" id="country" name="country" required
                            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    </div>
                </div>
            </div>

            <div
                class="overflow-hidden rounded-2xl bg-white shadow-sm ring-1 ring-slate-200 h-fit w-full lg:w-[40%] pb-7 lg:self-start">
                <div class="border-b border-slate-200 px-6 py-5">
                    <h3 class="text-lg font-semibold text-slate-900">Order Summary</h3>
                </div>

                <div class="px-6">
                    <div class="flex items-center justify-between py-6 border-b border-slate-200 font-semibold text-sm">
                        <p>Product</p>
                        <p>SubTotal</p>
                    </div>

                    <div class="max-h-60 overflow-y-auto custom-scrollbar">
                        {% for c in cart %}
                        <div class="flex items-center justify-between py-4 border-b border-slate-100 text-sm">
                            <p class="truncate w-2/3">{{c.product.name}} <span
                                    class="text-xs text-slate-500">x{{c.qty}}</span></p>
                            <p class="font-medium">${{c.product.sale_price}}</p>
                        </div>
                        {% endfor %}
                    </div>

                    <div class="flex items-center justify-between py-6">
                        <span class="text-base font-semibold text-slate-900">Total</span>
                        <span class="text-xl font-bold text-slate-900">${{total}}</span>
                    </div>

                    <button type="submit"
                        class="mt-2 h-12 w-full rounded-full bg-indigo-600 text-sm font-semibold text-white hover:bg-indigo-700 transition-colors shadow-md">
                        Process to checkout
                    </button>
                </div>
            </div>

        </div>
    </form>

    {% else %}

    <div class="mt-8 rounded-2xl bg-white p-10 text-center shadow-sm ring-1 ring-slate-200">
        <div class="flex flex-col items-center justify-center gap-2">
            <i class="fa-solid fa-cart-shopping text-4xl text-slate-300"></i>
            <h3 class="mt-2 text-lg font-semibold text-slate-900">Your cart is empty</h3>
            <p class="text-slate-500">Looks like you haven't added any items to your cart yet.</p>
            <a href="{% url 'index' %}"
                class="mt-4 rounded-full bg-indigo-600 px-6 py-2.5 text-sm font-medium text-white hover:bg-indigo-700">
                Start Shopping
            </a>
        </div>
    </div>

    {% endif %}

</section>
{% endblock content %}